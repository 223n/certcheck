version: '{build}'
clone_folder: c:\users\appveyor\certcheck
environment:
  GOPATH: c:\gopath
  matrix:
  - GOOS: windows
    GOARCH: 386
    FILENAME: certcheck_windows_386.exe
  - GOOS: windows
    GOARCH: amd64
    FILENAME: certcheck_windows_amd64.exe
  - GOOS: linux
    GOARCH: 386
    FILENAME: certcheck_linux_386
  - GOOS: linux
    GOARCH: amd64
    FILENAME: certcheck_linux_amd64
install:
  - ps: |
      go get gopkg.in/yaml.v2
      set PATH=%PATH%;%GOPATH%\bin
      $(Get-Content "c:\users\appveyor\certcheck\certcheck.go") -replace "{version}","${env:APPVEYOR_BUILD_VERSION}" -replace "{revision}","${version}" > "c:\users\appveyor\certcheck\certcheck.go"
      echo "version ${env:APPVEYOR_BUILD_VERSION}"
      echo "revision ${version}"
before_build:
  - set GOOS=%_GOOS%
  - set GOARCH=%_GOARCH%
build_script:
  - go build -o FILENAME
artifacts:
  - path: 'c:\users\appveyor\certcheck\certcheck_windows_386.exe'
  - path: 'c:\users\appveyor\certcheck\certcheck_windows_amd64.exe'
  - path: 'c:\users\appveyor\certcheck\certcheck_linux_386'
  - path: 'c:\users\appveyor\certcheck\certcheck_linux_amd64'
